<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>方言字典数据管理</title>
    <style>
        .admin-container {
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
            font-family: Arial, sans-serif;
        }
        
        .admin-section {
            background: white;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        
        input, textarea {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        
        button {
            background: #4a6fa5;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin-right: 10px;
        }
        
        button:hover {
            background: #6b8cbc;
        }
        
        .data-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        
        .data-table th, .data-table td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: left;
        }
        
        .data-table th {
            background: #f5f7fa;
        }
        
        .action-buttons {
            display: flex;
            gap: 5px;
        }
        
        .edit-btn {
            background: #28a745;
        }
        
        .delete-btn {
            background: #dc3545;
        }
        
        .export-btn {
            background: #ffc107;
            color: black;
        }
        
        .import-section {
            border: 2px dashed #ddd;
            padding: 20px;
            text-align: center;
            margin: 20px 0;
        }
    </style>
</head>
<body>
    <div class="admin-container">
        <h1>方言字典数据管理</h1>
        
        <!-- 添加/编辑表单 -->
        <div class="admin-section">
            <h2 id="form-title">添加新字词</h2>
            <form id="word-form">
                <div class="form-group">
                    <label for="character">单字 *</label>
                    <input type="text" id="character" required>
                </div>
                <div class="form-group">
                    <label for="bvz">BVZ读音 *</label>
                    <input type="text" id="bvz" required>
                </div>
                <div class="form-group">
                    <label for="note">注释</label>
                    <textarea id="note" rows="3"></textarea>
                </div>
                <button type="submit" id="submit-btn">添加字词</button>
                <button type="button" id="cancel-btn" style="display:none;">取消编辑</button>
            </form>
        </div>
        
        <!-- 批量操作 -->
        <div class="admin-section">
            <h2>批量操作</h2>
            <button id="export-btn" class="export-btn">导出JSON数据</button>
            <button id="import-btn">导入JSON数据</button>
            
            <div class="import-section" id="import-area" style="display:none;">
                <p>粘贴JSON数据或选择JSON文件：</p>
                <textarea id="import-data" rows="10" style="width:100%;"></textarea>
                <input type="file" id="file-input" accept=".json">
                <button onclick="importData()">确认导入</button>
                <button onclick="hideImport()">取消</button>
            </div>
        </div>
        
        <!-- 数据列表 -->
        <div class="admin-section">
            <h2>字典数据列表</h2>
            <div id="data-count">共加载 0 条记录</div>
            <table class="data-table">
                <thead>
                    <tr>
                        <th>单字</th>
                        <th>BVZ读音</th>
                        <th>注释</th>
                        <th>操作</th>
                    </tr>
                </thead>
                <tbody id="data-table-body">
                </tbody>
            </table>
        </div>
    </div>

    <script>
        // 当前编辑的条目索引
        let currentEditIndex = -1;
        
        // 初始化
        document.addEventListener('DOMContentLoaded', function() {
            loadData();
            setupEventListeners();
        });
        
        // 设置事件监听器
        function setupEventListeners() {
            // 表单提交
            document.getElementById('word-form').addEventListener('submit', function(e) {
                e.preventDefault();
                saveWord();
            });
            
            // 取消编辑
            document.getElementById('cancel-btn').addEventListener('click', function() {
                resetForm();
            });
            
            // 导出数据
            document.getElementById('export-btn').addEventListener('click', exportData);
            
            // 显示导入区域
            document.getElementById('import-btn').addEventListener('click', function() {
                document.getElementById('import-area').style.display = 'block';
            });
            
            // 文件导入
            document.getElementById('file-input').addEventListener('change', function(e) {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        document.getElementById('import-data').value = e.target.result;
                    };
                    reader.readAsText(file);
                }
            });
        }
        
        // 加载数据
        async function loadData() {
            try {
                const response = await fetch('https://raw.githubusercontent.com/Seing-ji/DICTIONARY_of_Suixi_Vernacular_of_Yue_Chinese/main/DICTIONARY.json');
                const data = await response.json();
                localStorage.setItem('dictionaryData', JSON.stringify(data));
                renderTable(data);
            } catch (error) {
                console.error('加载数据失败:', error);
                // 使用本地存储的数据
                const localData = localStorage.getItem('dictionaryData');
                if (localData) {
                    renderTable(JSON.parse(localData));
                }
            }
        }
        
        // 渲染表格
        function renderTable(data) {
            const tbody = document.getElementById('data-table-body');
            const countElement = document.getElementById('data-count');
            
            countElement.textContent = `共加载 ${data.length} 条记录`;
            tbody.innerHTML = '';
            
            data.forEach((item, index) => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${escapeHtml(item.單字)}</td>
                    <td>${escapeHtml(item.BVZ)}</td>
                    <td>${escapeHtml(item.Note || '')}</td>
                    <td class="action-buttons">
                        <button class="edit-btn" onclick="editWord(${index})">编辑</button>
                        <button class="delete-btn" onclick="deleteWord(${index})">删除</button>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }
        
        // 保存字词
        function saveWord() {
            const character = document.getElementById('character').value.trim();
            const bvz = document.getElementById('bvz').value.trim();
            const note = document.getElementById('note').value.trim();
            
            if (!character || !bvz) {
                alert('请填写单字和BVZ读音');
                return;
            }
            
            const data = JSON.parse(localStorage.getItem('dictionaryData') || '[]');
            const newItem = { 單字: character, BVZ: bvz, Note: note };
            
            if (currentEditIndex === -1) {
                // 添加新条目
                data.push(newItem);
            } else {
                // 更新现有条目
                data[currentEditIndex] = newItem;
            }
            
            localStorage.setItem('dictionaryData', JSON.stringify(data));
            renderTable(data);
            resetForm();
            alert(currentEditIndex === -1 ? '添加成功！' : '更新成功！');
        }
        
        // 编辑字词
        function editWord(index) {
            const data = JSON.parse(localStorage.getItem('dictionaryData') || '[]');
            const item = data[index];
            
            document.getElementById('character').value = item.單字;
            document.getElementById('bvz').value = item.BVZ;
            document.getElementById('note').value = item.Note || '';
            
            document.getElementById('form-title').textContent = '编辑字词';
            document.getElementById('submit-btn').textContent = '更新字词';
            document.getElementById('cancel-btn').style.display = 'inline-block';
            
            currentEditIndex = index;
        }
        
        // 删除字词
        function deleteWord(index) {
            if (confirm('确定要删除这个字词吗？')) {
                const data = JSON.parse(localStorage.getItem('dictionaryData') || '[]');
                data.splice(index, 1);
                localStorage.setItem('dictionaryData', JSON.stringify(data));
                renderTable(data);
            }
        }
        
        // 重置表单
        function resetForm() {
            document.getElementById('word-form').reset();
            document.getElementById('form-title').textContent = '添加新字词';
            document.getElementById('submit-btn').textContent = '添加字词';
            document.getElementById('cancel-btn').style.display = 'none';
            currentEditIndex = -1;
        }
        
        // 导出数据
        function exportData() {
            const data = JSON.parse(localStorage.getItem('dictionaryData') || '[]');
            const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'dictionary_export.json';
            a.click();
            URL.revokeObjectURL(url);
        }
        
        // 导入数据
        function importData() {
            const importData = document.getElementById('import-data').value.trim();
            if (!importData) {
                alert('请输入JSON数据');
                return;
            }
            
            try {
                const data = JSON.parse(importData);
                if (!Array.isArray(data)) {
                    throw new Error('数据格式不正确，应该是数组');
                }
                
                localStorage.setItem('dictionaryData', JSON.stringify(data));
                renderTable(data);
                hideImport();
                alert('导入成功！');
            } catch (error) {
                alert('JSON格式错误: ' + error.message);
            }
        }
        
        // 隐藏导入区域
        function hideImport() {
            document.getElementById('import-area').style.display = 'none';
            document.getElementById('import-data').value = '';
        }
        
        // HTML转义
        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }
    </script>
</body>
</html>
